<!DOCTYPE html>
<html>
  <head>
    <title>Plot microsimulation</title>

    <!-- Include order: first jquery, then opencpu.js, and then your code -->
    <script src="opencpu/jquery-1.10.2.min.js"></script>
    <script src="opencpu/opencpu-0.4.js"></script>

    <script>
     //init this script when the page has loaded
     $(document).ready(function(){
	 $("#submitbutton").on("click", function(){

             //disable the button to prevent multiple clicks
             $("#submitbutton").attr("disabled", "disabled");

             //read the value for 'myname'
             var nfield = parseInt($("#nfield").val());
             var screenfield = $("#screenfield").val();
	     var typefield = $("#typefield").val();

             //create the plot area on the plotdiv element
             var req = $("#plotdiv").rplot("myggplot", {
		 n : nfield,
		 screen : screenfield,
		 type : typefield
             })

             //if R returns an error, alert the error message
             req.fail(function(){
		 alert("Server error: " + req.responseText);
             });

             //after request complete, re-enable the button
             req.always(function(){
		 $("#submitbutton").removeAttr("disabled")
             });
		 var typefield = $("#typefield").val();
		 var timefield = $("#timefield").val();

		 //create the plot area on the plotdiv element
		 var req = $("#plotdiv").rplot("myggplot", {
		     n : nfield,
		     screen : screenfield,
		     type : typefield,
		     time : timefield
		 })
	 });
     });
    </script>

    <style>
      #plotdiv {
        position: relative;
        width: 600px;
        height: 400px;
        border: solid gray 1px;
      }
    </style>

  </head>

  <body>
      <h1>Microsimulation of prostate cancer in Sweden</h1>

      <b>n (count) </b> <input type="number" id="nfield" value="1000">

      <b>Screening scenario</b> <select id="screenfield">
	  <option>screenUptake</option>
	  <option>randomScreen50to70</option>
          <option>twoYearlyScreen50to70</option>
	  <option>fourYearlyScreen50to70</option>
          <option>screen50</option>
	  <option>screen60</option>
	  <option>screen70</option>
	  <option>screenUptake</option>
          <option>stockholm3_goteborg</option>
	  <option>stockholm3_risk_stratified</option>
          <option>goteborg</option>
	  <option>risk_stratified</option>
	  <option>mixed_screening</option>
          <option>regular_screen</option>
	  <option>single_screen</option>
      </select>


      <b>Type of outcome</b> <select id="typefield">
	  <option>incidence.rate</option>
	  <option>testing.rate</option>
	  <option>biopsy.rate</option>
	  <option>metastasis.rate</option>
	  <option>pc.mortality.rate</option>
	  <option>allcause.mortality.rate</option>
      </select>

      <br />
      <button id="submitbutton" type="button">Submit to server!</button>

      <div id="plotdiv"></div>

      <br />

      <p>
	  This application is a support package for the <a href="https://github.com/mclements/microsimulation">microsimulation</a> R package. It is intedend to help non R users by allowing a limitted number of analysis through the web. The visualistaion uses <a href="https://www.opencpu.org/">OpenCPU</a>.
      </p>

  </body>
			    <label>Time scale</label> <select id="timefield">
				<option>age</option>
				<option>year</option>
			    </select>

</html>
